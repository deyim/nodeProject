<div class="cont">
	<div class="titlearea">
		<div class="title">상품정보</div>
		<div class="nav">스토어관리 > 상품조회 > 상품등록</div>
	</div>
	
	<div class="product_write">
		<table cellpadding="0" cellspacing="0" class="de_table">
			<tbody>
				<tr>
					<th>카테고리*</th>
					<td colspan="3">
						
						<div class="category_box">
							<select class="inputstyle" name="category">
									<option value="">카테고리 선택</option>
									{{#each categories}}
										<option value={{this.id}}>{{this.name}}</option> 
									{{/each}}
							</select>
						</div>
					</td>
				</tr>
				
				<tr id="nation_city_choose">
					<th>국가 / 도시선택 *</th>
					<td colspan="3">
						<div class="input_25box">
							<select class="inputstyle" name="nation" id="nation_select">
								<option value="">국가 선택</option>
								{{#each nations}}
									<option value={{this.id}}>{{this.nation}}</option>
								{{/each}}
							</select>
						</div>
						
						<div class="input_25box" id="city_select">
							<select class="inputstyle" name="city" id="city_options">
							</select>
						</div>

						<div class="inline">
								<div class="plus_button" id="city_add">도시선택</div>
								<div class="plus_button" id="nation_add">행추가</div>
							</div>

						<div class="plus_boxarea" id="cities">
						</div>
					</td>
				</tr>
				
				<tr>
					<th>상품코드</th>
					<td>
						<div class="input_100box">
							<div id="productcode"></div>
							<input class="inputstyle" id="productcode_input" type="hidden" name="productcode">
						</div>						
						<button class="inline" id="codebutton">코드등록</button>
						{{!-- 옆으로 붙여라 나중에 --}}
					</td>
					<th>상품등록일자</th>
					<td>{{today}}</td>
				</tr>
				
				
				<tr>
					<th>상품명 *</th>
					<td colspan="3">
						<div class="input_100box"><input type="text" class="inputstyle" name="title"></input></div>
					</td>
				</tr>
				
				<tr>
					<th>홍보키워드</th>
					<td colspan="3">
						<div class="input_12box"><input type="text" class="inputstyle" name="tag1"></input></div>
						<div class="input_12box"><input type="text" class="inputstyle" name="tag2"></input></div>
						<div class="input_12box"><input type="text" class="inputstyle" name="tag3"></input></div>
						<div class="input_12box"><input type="text" class="inputstyle" name="tag4"></input></div>
						<div class="input_12box"><input type="text" class="inputstyle" name="tag5"></input></div>
					</td>
				</tr>
				
				<tr>
					<th>판매상태</th>
					<td colspan="3">
						<div class="inline"><input type="checkbox" name="onSaleChk" checked></input> 판매중</div>
					</td>
				</tr>
				
				
				<tr>
					<th>판매기간설정</th>
					<td colspan="3">
						<div class="calendar_box"><input type="date" name="startdate" id="src_date" value={{today}}><span><img src="/images/sub/calendar.jpg"></span></div>
						<div class="inline">-</div>
						<div class="calendar_box"><input type="date" name="enddate" id="target_date"><span><img src="/images/sub/calendar.jpg"></span></div>
						{{!-- <div class="priod_box inline">
							<select class="inputstyle" id="change_date">
								<option value="90">90일</option>
								<option value="120">120일</option>
								<option value="150">150일</option>
							</select>
						</div> --}}
					</td>
				</tr>
				
				<tr>
					<th>예약불가자일자 설정</th>
					<td colspan="3">
						<div class="calendar_box"><input type="date" id="tmp"><span><img src="/images/sub/calendar.jpg"></span></div>
						<button id="unavailable">추가</button>
						<div class="input_80box alret_date">
							<input type="text" class="inputstyle" id="unavailables" name="unavailables"></input>
						</div>
					</td>
				</tr>
				
				<tr>
					<th>상품 특성</th>
					<td colspan="3">
						<div class="inline"><input type="checkbox" name="periodType" value="A"></input> 기간일자 상품</div>
						<div class="inline"><input type="checkbox" name="periodType" value="B"></input> 단일일자 상품</div>
					</td>
				</tr>
				
				<tr>
					<th>상품 유형</th>
					<td colspan="3">
						<div class="listdg_button">
							<div class="inline"><input type="checkbox"></input> 단일 옵션상품</div>
							<div class="inline"><input type="checkbox"></input> 인원 옵션상품</div>					
						</div>
					</td>
				</tr>
				
				<tr class="option_title">
					<th>옵션/가격 *</th>
					<td colspan="3">
						<div class="listdg_button">
							<div class="inline">옵션명</div>
							<div class="input_80box"><input type="text" class="inputstyle" id="option_name"></input></div>
							
							<div class="plus_button" id="add_option_first">옵션추가</div>						
						</div>
					</td>
				</tr>
				
				<tr id="option_content">
					{{!-- <div class="option_content"> --}}
						<th>추가옵션/가격 *</th>
						<td colspan="3" >
							<div class="listdg_button" id="price_content">							
								{{!-- <div class="inline"><input type="checkbox" name="" value=""></input> 성인</div>
								<div class="inline"><input type="checkbox" name="" value=""></input> 아동</div> --}}
								<div class="priod_box inline">
									<select class="inputstyle" id="adult_or_child">
										<option value="adult">성인</option>
										<option value="child">아동</option>
									</select>
								</div>
								<div class="input_8box">
									<input type="text" id="start" name="start" class="inputstyle"></input>
								</div>명
								<div class="inline">-</div>
								<div class="input_8box">
									<input type="text" id="end" name="end" class="inputstyle"></input>
								</div>명: 
								<div class="input_8box">
									<input type="text" id="price" name="price" class="inputstyle"></input>
								</div>
								<div class="inline">원</div>
								
								<div class="plus_button remove_price" >
									<img src="/images/sub/minus_option.png">	
								</div>
								<div class="plus_button add_price" >
									<img src="/images/sub/plus_option.png">	
								</div>
								
							</div>
						</td>
					{{!-- </div> --}}
				</tr>
				
				
				
				<tr>
					<th>대표이미지 *</th>
					<td colspan="3">
						<div class="compulsory_img">
							<div class="compulory_text">대표이미지</div>
							<div class="image"><img src=""></div>
							<div class="buttonarea">
								<div class="change">변경</div>
								<div class="delete">삭제</div>
							</div>
						</div>
						
						<div class="compulsory_img">
							<div class="compulory_text">추가이미지</div>
							<div class="image">
								<div class="plus_imgicon"><img src="/images/sub/plus_img.png"></div>
							</div>
							<div class="buttonarea">
								<div class="change">찾아보기</div>
								
							</div>
						</div>
						
						<div class="compulsory_img">
							<div class="compulory_text">추가이미지</div>
							<div class="image">
								<div class="plus_imgicon"><img src="/images/sub/plus_img.png"></div>
							</div>
							<div class="buttonarea">
								<div class="change">찾아보기</div>
								
							</div>
						</div>
						
						<div class="compulsory_img">
							<div class="compulory_text">추가이미지</div>
							<div class="image">
								<div class="plus_imgicon"><img src="/images/sub/plus_img.png"></div>
							</div>
							<div class="buttonarea">
								<div class="change">찾아보기</div>
								
							</div>
						</div>
					</td>
				</tr>
				
				<tr>
					<th>목록이미지 *</th>
					<td colspan="3">
						<div class="listdg_button">
							<div class="dg_button">미리보기</div>
						</div>
						<div class="mar_t10"><textarea rows="15" class="textareastyle" name="content" id="content"></textarea></div>
					</td>
				</tr>
				
				<tr>
					<th>취소/환불안내 *</th>
					<td colspan="3">
						<textarea rows="5" class="textareastyle" name="policy" id="policy"></textarea>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	
	<div class="bot_button">
		<div class="bl_button">등록완료</div>
		<div class="wt_button">초기화</div>
	</div>
	
</div>

{{>editor_script}}
<script>


	$(document).ready(function(){
		$("#codebutton").click(function(){
			$.ajax({
				url: "/stores/products/getproductcode", 
				success: function(result){
					$("#productcode").text(result.code);
					$("#productcode_input").val(result.code);
			}});
		});
	});

//국가 선택에 따라 도시 바뀜
	$(document).ready(function(){
		$(document).on('change', '#nation_select', function(){
			$.ajax({
				url: "/stores/products/updatenation", 
				data: {
					nation: $(this).val()
				},
				success: function(result){
					$("#nation").val(result.nation.nation);
					$('#city_options').empty();
					$.each(result.cities, function (i, city) {
						$('#city_options').append($('<option>', { 
							value: city.id,
							text : city.city 
						}));
					});
			}});
		});
	});

//도시 추가
	$(document).ready(function(){
		 $(document).on('click', '#city_add', function(){
			let elt = document.getElementById('city_options');   
    		let city = elt.options[elt.selectedIndex].text;
			$('#cities').append("<div class='appended_city city_delete'>"+city+"<span>X<span></div>");
		});
	}); 

//국가 도시 선택 행 추가
	$(document).ready(function(){
		 $(document).on('click', '#nation_add', function(){
			let toCopy = $('#nation_city_choose').clone();
			$('#nation_city_choose').before(toCopy);
			$('#nation_city_choose').find('#cities').empty();
			

		});
	}); 

//도시 삭제
	$(document).ready(function(){
		$(document).on('click', '.city_delete', function(){
			$(this).remove();
		});
	}); 

//안되는 날짜 고르기
	$(document).ready(function(){
		$("#unavailable").click(function(){
			originalValue = $("#unavailables").val();
			newValue = $("#tmp").val();
			if(originalValue===''){
				originalValue = newValue;
			}else{
				originalValue = originalValue + ',' + newValue;
			}										
			$("#unavailables").val(originalValue);
		});
	}); 


	$(document).ready(function(){
		$('#option_content').hide();
	});

	$(document).ready(function(){
		$(document).on('click', '#add_option_first', function(){
			$('#option_content').find($('#price_content')).before("<div id='added_option_name'></div>");
			$('#option_content').find($('#added_option_name')).text($('#option_name').val());
			$('#option_content').show();
			$('#option_name').val("");
			$('#add_option_first').attr("id","add_option");
		});
	}); 

	$(document).ready(function(){
		$(document).on('click', '#add_option', function(){
			var content = $('#option_content').html();
			var newtr = $("<tr id='option_content'>");		
			newtr.html(content);
			
			
			$('#option_content').find($('#added_option_name')).text($('#option_name').val());
			$('#option_content').find($('.prices')).remove();
			$('#option_content').after(newtr);
			$('#option_name').val("");
		});
	}); 

	$(document).ready(function(){
		$(document).on('click', '.add_price', function(){
			var newdiv = $("<div class='prices'></div>");
			newdiv.text($('#adult_or_child').val()+' :    '+$('#start').val()+' 명    ~    '+$('#end').val()+' 명    '+$('#price').val()+' 원')
			console.log(newdiv.text());
        	$('#price_content').after(newdiv);
			$('#start').val("");
			$('#end').val("");
			$('#price').val("");
		});
	}); 

	$(document).ready(function(){
		$(document).on('click', '.remove_price', function(){
			console.log($(this).parent());
			$(this).parent().remove();
		});
	}); 


	{{!-- $(document).ready(function(){
		$(document).on('click', '#change_date', function(){
			var mydate = new Date($('#src_date').val());
			console.log(mydate);
			mydate.setDate(mydate.getDate() + $(this).val());
			console.log(mydate);

			var mm = mydate.getMonth() + 1; // getMonth() is zero-based
    		var dd = mydate.getDate();
  
            var thisDate =  [mydate.getFullYear(),
            (mm>9 ? '' : '0') + mm,
            (dd>9 ? '' : '0') + dd
           ].join('-');
			
			$('#target_date').val(thisDate);
		});
	});  --}}

</script>
